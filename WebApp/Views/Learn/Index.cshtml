@using WebApp.Models.ViewModels
@model LearnViewModels
@{
    ViewData["Title"] = "学习";
}
<!--导航部分-->
<div class="row">
    <ul class="learn-nav col-12 d-flex">
        <li class="nav-title">视频</li>
        @foreach (var item in Model.VideoCatalogs)
        {
            <li>
                <a asp-route-topCatalogId="@item.Id" asp-route-type="Video">
                    @item.Name
                </a>
            </li>
        }
    </ul>
</div>
<div class="row">
    <ul class="learn-nav d-flex col-12">
        <li class="nav-title">博客</li>
        @foreach (var item in Model.ArticleCatalogs)
        {
            <li>
                <a asp-route-topCatalogId="@item.Id" asp-route-type="Blog">
                    @item.Name
                </a>
            </li>
        }
    </ul>
</div>

@*<div class="row">
        <ul class="learn-nav d-flex">
            <li class="nav-title">练习</li>
            @foreach (var item in Model.ArticleCatalogs)
            {
                <li><a asp-route-id="@item.Id">@item.Name</a></li>
            }
        </ul>
    </div>
*@
<!--内容-->
<div class="row mt-2 learn-container">
    <!--左侧二级导航-->
    <div class="col col-md-auto p-2 bg-light mr-2 d-none d-sm-inline-block">
        <ul class="nav flex-column nav-pills">
            @foreach (var navs in Model.SecondaryNavs)
            {
                var active = "";
                if (navs.Id.ToString() == ViewBag.NavId as string){
                    active = "active";
                }
                <li class="nav-item">
                    <a asp-route-navId="@navs.Id" asp-route-type="@TempData["learnType"]" asp-route-topCatalogId="@Context.Request.Query["topCatalogId"]"
                       class="nav-link @active">
                        @navs.Name
                    </a>
                </li>
            }

        </ul>
    </div>
    <div class="col-md-12 p-2 bg-light d-sm-none">
        <select class="form-control custom-select" name="SecondaryNavs">
            @foreach (var navs in Model.SecondaryNavs)
            {
                if (navs.Id.ToString() == ViewBag.NavId as string)
                {
                    <option value="@navs.Id" selected>
                        @navs.Name
                    </option>
                }
                else
                {
                    <option value="@navs.Id">
                        @navs.Name
                    </option>
                }
            }

        </select>
    </div>

    <div class="col col-md-10 bg-light">
        <form asp-action="SetFilter" class="row justify-content-between form-inline text-dark py-1" style="border-bottom:1px solid #ddd">
            <input type="hidden" name="topCatalogId" value="@Context.Request.Query["topCatalogId"]" />
            <input type="hidden" name="navId" value="@Context.Request.Query["navId"]" />
            <input type="hidden" name="learnType" value="@TempData["learnType"]" />
            <div class="col-md-6">
                <select name="language" class="form-control form-control-sm">
                    <option value="">全部</option>
                    <option value="en">英文</option>
                    <option value="zh">中文</option>
                </select>

                @if (Model.EventList.Count > 0)
                {
                    <select name="eventId" class="form-control form-control-sm" style="max-width:240px">
                        @foreach (var item in Model.EventList as List<C9Event>)
                        {
                            <option value="@item.Id">
                                @Html.Raw(item.TopicName)
                            </option>
                        }
                    </select>
                }
                <button class="btn btn-sm btn-dark form-control" type="submit">筛选</button>
            </div>
            <div class="col-md-6 text-right">
                @*<input type="search" name="name" value="" class="form-control form-control-sm" />
                    <button class="btn btn-primary btn-sm" type="submit">搜索</button>*@
            </div>
        </form>
        <section name="videos" class="row">
            @if (Model.VideoList.Count > 0)
            {
                foreach (var item in Model.VideoList)
                {
                    //处理作者
                    var author = StringHelper.SubString(item.Author, 20);
                    author = string.IsNullOrWhiteSpace(author) ? "未知" : author;
                    <div class="col-md-4 px-2 my-2">
                        <div class="card border-0" style="box-shadow:1px 1px 3px 1px #ccc">
                            <a class="card-img-top" asp-action="@TempData["DetailPage"]" asp-controller="Video" asp-route-id="@item.Id" target="_blank">
                                <img src="@item.ThumbnailUrl" style="max-height:200px;width:100%" />
                            </a>
                            <div class="card-body p-1">
                                <h6 class="card-title mb-0">
                                    <a class="text-dark" asp-action="@TempData["DetailPage"]" asp-controller="Video" asp-route-id="@item.Id" target="_blank">
                                        @Html.Raw(@item.Name)
                                    </a>
                                </h6>
                                <div class="card-text justify-content-between d-flex">
                                    <div class="text-info">
                                        <small>
                                            作者:
                                            <span class="" title="@item.Author">
                                                @author
                                            </span>
                                        </small>
                                    </div>
                                    <div class="text-muted">
                                        <small>
                                            @item.CreatedTime.ToString("yyyy-MM-dd")
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
                <pager pager-option="Model.Pager as MyPagerOption"></pager>
            }
        </section>
        <section name="blogs" class="row">
            @foreach (var blog in Model.BlogList)
            {
                <div class="col-lg-6 mt-2 p-2 pl-4">
                    <h5>
                        <a class="text-dark" asp-action="Blog" asp-route-id="@blog.Id">@blog.Title</a>
                    </h5>
                    <small class="text-muted">
                        @blog.AuthorName @blog.CreatedTime.ToString("yyyy-MM-dd H:mm")
                        &nbsp;&nbsp;@(blog.Views == null ? "" : "浏览:" + blog.Views)
                    </small>
                </div>
            }
        </section>
        <section name="practices"></section>
    </div>
</div>

@section Scripts{
    <script>
        $(document).ready(function () {
            $("select[name='language'] option[value='@TempData["language"]']").attr("selected", "selected");
            $("select[name='eventId'] option[value='@Context.Request.Query["eventId"]']").attr("selected", "selected");

            $("select[name='SecondaryNavs']").change(function () {
                var navId = $(this).val();
                location.href = `/Learn?navId=${navId}
                    &topCatalogId=@Context.Request.Query["topCatalogId"]
                    &type=@TempData["learnType"]`;
            });

        });

    </script>

}